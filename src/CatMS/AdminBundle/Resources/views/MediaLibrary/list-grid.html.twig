{% extends 'CatMSAdminBundle::base.html.twig' %}

{% block breadcrumb %}
    {{ parent() }}
    <li class="active">Media library</li>
    <a href="{{ path('media-library') }}" class="list-home-url" style="display: none;"></a>
{% endblock %}    
    
{% block content -%}
    <script src="{{ asset('js/catms-media-library-grid-view.js') }}"></script>
    
    <div class="notice-container"></div>
     
    <legend>
        <i class="icon-large icon-picture"></i> Media library assets
        <a href="{{ path('media-library', {'page': 1}) }}" title="Details View" style="float: right;"><i class="icon-large icon-list"></i></a>
    </legend>

    <div class="grid">
        <a href="{{ path('get-images-list-ajax') }}" id="getImagesList" style="display: none;"></a>
        <a href="{{ asset('uploads/media-library/') }}" id="dirPath" style="display: none;"></a>
        <a href="{{ path('media-library-image-edit') }}" id="editPath" style="display: none;"></a>
        
        <ul class="grid-list" data-view="0">

        </ul>
    </div>
    <div class="more-btn-container">
        <a href="" class="btn btn-info btn-small"><i class="icon-chevron-down"></i> Show More</a>
    </div>
    

    <a href="{{ path('media-library-upload') }}" class="btn btn-small btn-success"><i class="icon-upload"></i> 
        Upload file
    </a>

    
<script>
$(function() {
    showLoader();
    
    $('.more-btn-container').hide();
    
    var URL = $('#getImagesList').attr('href');
    var page = parseInt($('.grid-list').attr('data-view') + 1);
    
    $.ajax({
        type: 'POST',
        url: URL,
        dataType: 'json',
        data: {'page': page},
        success: function(data) {
            renderList(data, $('.grid-list'));
            closeLoader();
            $('.grid-list').attr('data-view', page);
        },
        error: function(XMLHttpRequest, textStatus, errorThrown){
            alert(errorThrown);
            closeLoader();
        }
    });
    
    $('.more-btn-container a.btn').click(function() {
        showLoader();
        var page = parseInt($('.grid-list').attr('data-view')) + 1;

        $.ajax({
            type: 'POST',
            url: URL,
            dataType: 'json',
            data: {'page': page},
            success: function(data) {
                console.log(data);
                renderList(data, $('.grid-list'));
                closeLoader();
                $('.grid-list').attr('data-view', page);
            },
            error: function(XMLHttpRequest, textStatus, errorThrown){
                alert(errorThrown);
                closeLoader();
            }
        });
        return false;
    });
    
});

function renderList(data, container) {
    var list = '';
    var dir = $('#dirPath').attr('href');
    var editPath = $('#editPath').attr('href');
    $.each(data.images, function(i, obj){
        list = list + '<li>' + 
            '<a href="' + dir + obj.path + '" class="single-image"><img class="img-polaroid" src="/' + obj.thumb + '" /></a>' +
            '<a href="' + dir + obj.path + '" class="btn btn-mini btn-success copy-source">Copy Source</a>' +
            '<a href="' + editPath + '/' + obj.id + '" class="btn btn-mini btn-primary">Edit<a/>' +
            '</li>';
    });
    container.append(list);
    
    if (data.hasMore) {
        $('.more-btn-container').show();
    } else {
        $('.more-btn-container').hide();
    }
}
</script>
{% endblock %}